---
layout: post
title: [Error Fix] loss 가 nan값으로 나오는 문제 해결하기
description: >
  2023.05.26 열다섯번째 게시글
tags: [hydejack]
---

# [Error Fix] loss 가 nan값으로 나오는 문제 해결하기

## 회사에서 기존 모델을 다른 모델로 변경해서 사용해보기 위해 모델을 직접 구현해서 train 코드를 짜서 학습을 돌려봤다. 여러 에러들이 있었지만 잘 돌아가니 다행이라고 생각하고 밥을 먹으러 갔는데...
## 밥을 먹고 돌아와서 학습 현황을 보니 loss 값이 nan 값으로 계산되어 나오고 있었다..

## 원인을 찾고 에러를 고쳐보자. 나중에도 필요할 것 같아 History 로 남기기 위해 포스트를 작성한다.


## 우선, 검색을 해본 결과로는 다음과 같은 문제들이 있을 수 있다고 했다.

* input data 에 nan 값이 있는 경우
* 데이터 타입이 float 외 다른 형태일 경우
* learningrate 가 너무 높은 경우
* loss 계산 수식 자체의 오류
* 불안정한 기울기값
* 손실 함수가 호환되지 않을 경우
* Optimizer 의 오류
* 특성 스케일의 오류
* 데이터와 output scale 의 불일치 

## 아... 너무 많지만 하나씩 천천히 체크해보자

* input data 에 nan 값이 있는 경우
    * input data 는 원래 모델에서도 사용하던 input data 를 사용했기에 문제가 되지 않는다.
* 데이터 타입이 float 외 다른 형태일 경우
    * 데이터 타입은 이미 float 형태이기에 문제가 되지 않는다.
* learningrate 가 너무 높은 경우
    * learningrate 를 상당히 낮게 사용하고 있기에 아닐것이다.
* 손실 함수가 호환되지 않을 경우
    * 손실 함수는 output 과 호환되기에 문제가 되지 않는다.
* Optimizer 의 오류
    * Optimizer 는 논문 그대로 사용했기에 아닐 것 같다.
    
## 이제 남은 문제들은 아래와 같다
* 특성 스케일의 오류
* 데이터와 output scale 의 불일치 
* loss 계산 수식 자체의 오류
* 불안정한 기울기값

## 나는 저 중에서도 loss 계산 수식에서 output 을 받는데에 오류가 있을거라고 생각했다.

## get_loss 함수에서 print(loss) 를 이용해서 loss 를 출력해보니 input들은 값이 잘 나오는데 loss 가 nan값이 나왔다.

## 내 문제는 모델 구현 코드에서 마지막 값을 Linear(4096, 1) 로 출력했었는데 Sigmoid 로 변환해서 output 을 뽑는 원래 코드를 참고하면서 정작 내 모델에서는 Sigmoid 함수를 적용해주지 않아서 발생한 문제였다.

_혹시나 누가 보게 된다면 이 게시글이 도움이 되기를 바라며_
